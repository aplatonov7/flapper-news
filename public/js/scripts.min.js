var app=angular.module("flapperNews",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(t,n){t.state("home",{url:"/home",templateUrl:"/home.html",controller:"MainCtrl",resolve:{postPromise:["posts",function(t){return t.getAll()}]}}).state("posts",{url:"/posts/{id}",templateUrl:"/posts.html",controller:"PostsCtrl"}),n.otherwise("home")}]),app.controller("MainCtrl",["$scope","posts",function(t,n){t.userPost={},t.posts=n,t.pageSize=3,t.currentPage=0,t.prevPage=function(){t.currentPage--},t.nextPage=function(){t.currentPage++},t.paginationStatusNext=function(){return t.currentPage>Math.ceil(t.posts.container.length/t.pageSize)-2},angular.element(document).ready(function(){componentHandler.upgradeAllRegistered()}),t.submitForm=function(){if(t.userPost.title){var e={title:t.userPost.title,content:t.userPost.content,image:t.userPost.image,rating:0};n.addPost(e)}}}]),app.controller("PostsCtrl",["$scope","$stateParams","posts",function(t,n,e){angular.element(document).ready(function(){componentHandler.upgradeAllRegistered()}),t.post=e.container[n.id],t.submitForm=function(){e.addComment(t.post,t.userComment.author,t.userComment.body)}}]),app.filter("startFrom",function(){return function(t,n){return t?(n=+n,t.slice(n)):[]}}),app.factory("posts",["imgurLinkGenerator","$http",function(t,n){function e(t,n,e){this.author=t?t:"John Doe",this.body=n?n:"No comment",this.rating=e?e:0}function o(t,n,e,o,r){this.title=t?t:"",this.link=n?n:"",this.content=e?e:"",this.comments=o?o:[],this.rating=r?r:0}var r={container:[]};return r.Post=o,r.Comment=e,r.getAll=function(){return n.get("/posts").success(function(t){angular.copy(t,r.container)})},r.addPost=function(e){(e.image+"").match(/^(http:\/\/){0,1}i.imgur.com\/[A-Za-z0-9]{5,7}\.(jpg|png|jpeg|gif)$/i)?n.post("/posts",e).success(function(t){r.container.push(t)}):t.getImgurLink().then(function(t){e.image=t,n.post("/posts",e).success(function(t){r.container.push(t)})})},r.addComment=function(t,n,o){var r=new e(n,o);t.comments.push(r)},r.upvote=function(t){t.rating+=1},r.downvote=function(t){t.rating-=1},r}]),app.factory("imgurLinkGenerator",["$q",function(t){function n(t,n){return Math.round(Math.random()*(n-t)+t)}function e(t){for(var s,a=n(0,1)?5:7,u="";a--;)s=r[n(0,i)],u+=s;img=new Image,img.addEventListener("load",function(){this.width<=300||this.height<=300?e(t):t.resolve(this.src)},!1),img.addEventListener("error",function(){e(t)},!1),img.src=o+u+".jpg"}var o="http://i.imgur.com/",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=r.length-1,s=function(){var n=t.defer();return e(n),n.promise};return{getImgurLink:s}}]);